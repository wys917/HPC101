🔍 Qwen3模型实际显存占用测量
============================================================
🎯 GPU设备: Tesla V100-SXM2-32GB
🎯 GPU总显存: 31.73 GB

📊 基线显存:
   已分配: 0.000 GB
   已保留: 0.000 GB

🔧 创建模型配置...
🏗️ 在CPU上创建模型...
📈 模型参数量: 7,721,988,096 (7.72B)
📊 理论显存占用: 14.38 GB

🚀 移动模型到GPU...
📊 模型加载后显存:
   已分配: 29.767 GB
   已保留: 29.768 GB
   模型占用: 29.767 GB

🔄 转换为bfloat16...
📊 bfloat16转换后显存:
   已分配: 14.883 GB
   已保留: 30.928 GB
   模型占用: 14.883 GB

🧪 进行推理测试...
📊 推理测试 (seq_len=10):
   总显存: 14.897 GB
   推理开销: 0.014 GB
📊 推理测试 (seq_len=50):
   总显存: 14.920 GB
   推理开销: 0.036 GB
📊 推理测试 (seq_len=100):
   总显存: 14.948 GB
   推理开销: 0.065 GB
📊 推理测试 (seq_len=200):
   总显存: 15.005 GB
   推理开销: 0.121 GB

🖥️ nvidia-smi 当前状态:
Tue Aug 26 08:51:15 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 575.57.08              Driver Version: 575.57.08      CUDA Version: 12.9     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  Tesla V100-SXM2-32GB           On  |   00000000:B5:00.0 Off |                    0 |
| N/A   37C    P0            236W /  300W |   16808MiB /  32768MiB |    100%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
+-----------------------------------------------------------------------------------------+

============================================================
📊 理论 vs 实际对比:
============================================================
理论显存占用: 14.383 GB
实际显存占用: 14.883 GB
差异: 0.500 GB
差异百分比: 3.48%
✅ 理论与实际基本一致

🔍 可能的差异原因:
1. 内存对齐: GPU要求特定边界对齐
2. PyTorch开销: 框架元数据和管理开销
3. CUDA上下文: GPU驱动基础开销
4. 内存池: PyTorch内存管理机制
GPU程序执行完成！
